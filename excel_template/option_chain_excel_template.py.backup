# excel_template/option_chain_excel_template.py
import os
import sys

def get_template():
    """è®€å–é¸æ“‡æ¬Š Excel æ¨¡æ¿çš„ Base64 å­—ä¸²"""
    try:
        # è™•ç†æ‰“åŒ…å¾Œçš„è·¯å¾‘
        if getattr(sys, 'frozen', False):
            # æ‰“åŒ…å¾Œï¼šåœ¨ exe æ‰€åœ¨ç›®éŒ„
            base_path = os.path.dirname(sys.executable)
        else:
            # é–‹ç™¼ç’°å¢ƒï¼šåœ¨ç•¶å‰æª”æ¡ˆçš„ç›®éŒ„
            base_path = os.path.dirname(os.path.abspath(__file__))
        
        # ğŸ”¥ ä¿®å¾©ï¼šä½¿ç”¨ç›¸å°è·¯å¾‘æˆ–æ­£ç¢ºçš„çµ•å°è·¯å¾‘
        template_file = os.path.join(base_path, 'Option_New_Modle.txt')

        # å¦‚æœç•¶å‰ç›®éŒ„æ‰¾ä¸åˆ°ï¼Œå˜—è©¦ä¸Šå±¤ç›®éŒ„
        if not os.path.exists(template_file):
            template_file = os.path.join(os.path.dirname(base_path), 'excel_template', 'Option_New_Modle.txt')

        # å¦‚æœé‚„æ˜¯æ‰¾ä¸åˆ°ï¼Œä½¿ç”¨ä½ æä¾›çš„çµ•å°è·¯å¾‘ä½œç‚ºå¾Œå‚™
        if not os.path.exists(template_file):
            template_file = r'C:\Users\2993\Downloads\option_template\Option_New Modle.txt'

        if not os.path.exists(template_file):
            print(f"âš ï¸ è­¦å‘Šï¼šæ‰¾ä¸åˆ°é¸æ“‡æ¬Šæ¨¡æ¿æª”æ¡ˆ")
            print(f"   å˜—è©¦çš„è·¯å¾‘: {template_file}")
            return ""

        print(f"âœ“ æ­£åœ¨è¼‰å…¥é¸æ“‡æ¬Šæ¨¡æ¿: {template_file}")
        with open(template_file, 'r', encoding='utf-8') as f:
            content = f.read().strip()
            print(f"âœ“ é¸æ“‡æ¬Šæ¨¡æ¿è¼‰å…¥æˆåŠŸ ({len(content)} å­—å…ƒ)")
            return content

    except Exception as e:
        print(f"âŒ è®€å–é¸æ“‡æ¬Šæ¨¡æ¿å¤±æ•—: {e}")
        return ""

# ğŸ”¥ ä¿®å¾©ï¼šç«‹å³åˆå§‹åŒ–ï¼Œè€Œä¸æ˜¯è¨­ç‚º None
Option_Chain_Excel_Template_Base64 = get_template()

# å¦‚æœéœ€è¦å»¶é²åŠ è¼‰ï¼Œå¯ä»¥ä½¿ç”¨é€™å€‹å‡½æ•¸
def reload_template():
    """é‡æ–°è¼‰å…¥æ¨¡æ¿ï¼ˆç”¨æ–¼èª¿è©¦ï¼‰"""
    global Option_Chain_Excel_Template_Base64
    Option_Chain_Excel_Template_Base64 = get_template()
    return Option_Chain_Excel_Template_Base64